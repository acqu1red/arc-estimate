# Инструкция по визуальному тестированию статичности стен

## Цель тестирования
Убедиться, что стены теперь имеют корректную геометрию в мировых координатах и правильно масштабируются при зуме.

## Что было исправлено
**СТАРАЯ СИСТЕМА (неправильная):**
- Стены рисовались с фиксированной толщиной **6 пикселей** на экране
- При зуме геометрия стены масштабировалась, но визуальная "толщина" оставалась 12 пикселей
- Это создавало визуальный артефакт: при отдалении стены выглядели нереалистично толстыми

**НОВАЯ СИСТЕМА (правильная):**
- Стены рисуются с реальной толщиной из `Wall::GetThickness()` (например, 150мм, 200мм, 380мм)
- Углы стены вычисляются в мировых координатах (мм)
- Затем все 4 угла преобразуются в экранные координаты через `Camera::WorldToScreen()`
- При зуме ВСЯ геометрия (включая толщину) масштабируется пропорционально
- Система работает как в AutoCAD/nanoCAD

---

## Тестовые сценарии

### ТЕСТ 1: Базовая проверка толщины стен

**Шаги:**
1. Запустить приложение
2. Создать стену толщиной **150мм**
3. Создать стену толщиной **380мм** рядом
4. Установить масштаб **1:50** (zoom = 0.5)

**Ожидаемый результат:**
- ? Стена 150мм визуально **тоньше** стены 380мм
- ? Пропорция примерно 1:2.5 (380/150 = 2.53)
- ? Обе стены имеют четкую обводку толщиной 2 пикселя
- ? Обводка видна и не "размывается"

**Проблемы старой системы:**
- ? Обе стены были одинаковой толщины (12 пикселей)
- ? Реальная толщина не учитывалась

---

### ТЕСТ 2: Масштаб 1:20 (крупный план)

**Шаги:**
1. Выбрать масштаб **1:20** в комбобоксе ScaleComboBox
2. Это установит zoom = 1.25
3. Посмотреть на стену 150мм

**Ожидаемый результат:**
- ? Стена 150мм занимает на экране: 150мм ? 1.25 = **187.5 пикселей**
- ? Стена выглядит **широкой** на экране
- ? Детали стены хорошо видны
- ? Обводка 2px четкая и не теряется

**Формула расчета:**
```
Ширина_на_экране = толщина_мм ? zoom
150мм ? 1.25 = 187.5 пикселей
```

---

### ТЕСТ 3: Масштаб 1:50 (стандартный)

**Шаги:**
1. Выбрать масштаб **1:50**
2. Это установит zoom = 0.5
3. Посмотреть на ту же стену 150мм

**Ожидаемый результат:**
- ? Стена 150мм занимает на экране: 150мм ? 0.5 = **75 пикселей**
- ? Стена выглядит **нормальной толщины**
- ? Пропорции корректные
- ? Обводка видна

---

### ТЕСТ 4: Масштаб 1:100 (мелкий)

**Шаги:**
1. Выбрать масштаб **1:100**
2. Это установит zoom = 0.25
3. Посмотреть на стену 150мм

**Ожидаемый результат:**
- ? Стена 150мм занимает на экране: 150мм ? 0.25 = **37.5 пикселей**
- ? Стена выглядит **тонкой**, но видимой
- ? Обводка 2px помогает различить стену
- ? Пропорции с другими стенами сохраняются

---

### ТЕСТ 5: Масштаб 1:200 (очень мелкий)

**Шаги:**
1. Выбрать масштаб **1:200**
2. Это установит zoom = 0.125
3. Посмотреть на стену 150мм

**Ожидаемый результат:**
- ? Стена 150мм занимает на экране: 150мм ? 0.125 = **18.75 пикселей**
- ? Стена видна как **тонкая линия**
- ? Обводка 2px критически важна для видимости
- ? Геометрия правильная

---

### ТЕСТ 6: Масштаб 1:500 (экстремально мелкий)

**Шаги:**
1. Выбрать масштаб **1:500**
2. Это установит zoom = 0.05
3. Посмотреть на стену 150мм

**Ожидаемый результат:**
- ? Стена 150мм занимает на экране: 150мм ? 0.05 = **7.5 пикселей**
- ? Стена выглядит как очень тонкая линия
- ?? На этом масштабе детали теряются, но это **нормально**
- ? Обводка 2px всё ещё делает стену видимой
- ? Это соответствует поведению AutoCAD

---

### ТЕСТ 7: Плавный зум колесом мыши

**Шаги:**
1. Создать несколько стен разной толщины (150мм, 200мм, 380мм)
2. Начать плавно крутить колесо мыши для зума
3. Наблюдать за изменением стен

**Ожидаемый результат:**
- ? При ПРИБЛИЖЕНИИ (zoom увеличивается):
  - Все стены становятся **шире пропорционально**
  - Стена 380мм всегда **толще** стены 150мм
  - Пропорции сохраняются
  - Обводка 2px остается фиксированной

- ? При ОТДАЛЕНИИ (zoom уменьшается):
  - Все стены становятся **тоньше пропорционально**
  - Стена 380мм всегда **толще** стены 150мм
  - Пропорции сохраняются
  - Обводка помогает различать стены

- ? **НЕ ДОЛЖНО быть:** стены "прыгают" или меняют размер непредсказуемо
- ? **НЕ ДОЛЖНО быть:** все стены одинаковой толщины

---

### ТЕСТ 8: Preview стены при рисовании

**Шаги:**
1. Активировать инструмент "Стена" (WallTool)
2. Начать рисовать стену (клик, затем двигать мышь)
3. Не отпуская, изменить масштаб колесом мыши

**Ожидаемый результат:**
- ? Preview стена выглядит **идентично** реальной стене
- ? При зуме preview масштабируется правильно
- ? Preview не "прыгает" и не меняет толщину хаотично
- ? После клика созданная стена выглядит так же как preview

---

### ТЕСТ 9: Сравнение с AutoCAD/nanoCAD (если доступен)

**Шаги:**
1. Открыть AutoCAD или nanoCAD
2. Создать стену толщиной 150мм
3. Изменять масштаб (zoom in / zoom out)
4. Сравнить поведение с нашим приложением

**Ожидаемый результат:**
- ? Наше приложение ведет себя **аналогично AutoCAD**
- ? При зуме геометрия масштабируется пропорционально
- ? Тонкие линии остаются тоньше толстых на любом масштабе
- ? Обводка помогает различать элементы на мелких масштабах

---

### ТЕСТ 10: Экстремальные случаи

**Шаги:**
1. Создать очень тонкую стену (50мм - минимум)
2. Создать очень толстую стену (1000мм - максимум)
3. Установить масштаб 1:500 (zoom = 0.05)
4. Затем масштаб 1:20 (zoom = 1.25)

**Ожидаемый результат при 1:500:**
- ? Стена 50мм: 50 ? 0.05 = **2.5 пикселя** - едва видна (линия)
- ? Стена 1000мм: 1000 ? 0.05 = **50 пикселей** - хорошо видна
- ? Разница в 20 раз очевидна

**Ожидаемый результат при 1:20:**
- ? Стена 50мм: 50 ? 1.25 = **62.5 пикселя** - тонкая
- ? Стена 1000мм: 1000 ? 1.25 = **1250 пикселей** - очень широкая
- ? Разница в 20 раз очевидна

---

## Что делать при обнаружении проблем

### Проблема 1: Все стены одинаковой толщины
**Причина:** Изменения не применились или старая версия кода
**Решение:** 
- Проверить что WallRenderer.h использует `wall.GetCornerPoints()`
- Пересобрать проект (Clean + Rebuild)
- Проверить что `m_wallHalfWidthPx` удален

### Проблема 2: Стены слишком тонкие на всех масштабах
**Причина:** Возможно zoom в Camera слишком мал
**Решение:**
- Проверить `Camera::GetZoom()` - должно быть от 0.01 до 10.0
- Проверить что ScaleComboBox правильно устанавливает zoom
- Проверить что стены имеют реальную толщину (150мм, не 1.5мм)

### Проблема 3: Стены "прыгают" при зуме
**Причина:** Возможно Camera::ZoomAt не работает корректно
**Решение:**
- Проверить метод `Camera::ZoomAt()`
- Убедиться что offset пересчитывается правильно
- Проверить точку pivot для зума

### Проблема 4: Обводка слишком толстая или не видна
**Причина:** Неправильные значения stroke width
**Решение:**
- Изменить `m_wallStrokeWidthPx` (текущее значение: 2.0f)
- Рекомендуемый диапазон: 1.0f - 3.0f
- Для очень тонких стен может потребоваться 1.5f

### Проблема 5: Preview стены отличается от реальной
**Причина:** DrawPreview использует другую логику
**Решение:**
- Проверить что DrawPreview вызывает DrawWall
- Убедиться что создается временный Wall с правильной толщиной

---

## Критерии успешного теста

### ? ТЕСТ ПРОЙДЕН если:
1. Стены разной толщины визуально отличаются на ЛЮБОМ масштабе
2. Пропорции между стенами сохраняются при зуме
3. При приближении ВСЁ увеличивается пропорционально (не только стены)
4. При отдалении ВСЁ уменьшается пропорционально
5. Обводка (2px) остается четкой и видимой
6. Preview стены выглядит идентично реальной
7. Поведение похоже на AutoCAD/nanoCAD

### ? ТЕСТ ПРОВАЛЕН если:
1. Все стены одинаковой толщины независимо от GetThickness()
2. Стены "прыгают" или меняются непредсказуемо при зуме
3. Пропорции между стенами нарушаются
4. Preview отличается от реальной стены
5. На крупных масштабах стены выглядят как "линии"
6. На мелких масштабах стены занимают весь экран

---

## Визуальное сравнение: ДО и ПОСЛЕ

### ДО (неправильно):
```
Масштаб 1:50 (zoom=0.5):
Стена 150мм: ???????????? (12px - фиксировано)
Стена 380мм: ???????????? (12px - фиксировано)
                ? ОДИНАКОВЫЕ!

Масштаб 1:100 (zoom=0.25):
Стена 150мм: ???????????? (12px - фиксировано)
Стена 380мм: ???????????? (12px - фиксировано)
                ? ОДИНАКОВЫЕ!
```

### ПОСЛЕ (правильно):
```
Масштаб 1:50 (zoom=0.5):
Стена 150мм: ??????????????????????????????????????? (75px)
Стена 380мм: ???????????????????????????????????????????????????????????????????????????????????????????????? (190px)
                ? ПРОПОРЦИОНАЛЬНЫЕ (2.5x разница)

Масштаб 1:100 (zoom=0.25):
Стена 150мм: ??????????????????? (37.5px)
Стена 380мм: ??????????????????????????????????????????????????? (95px)
                ? ПРОПОРЦИОНАЛЬНЫЕ (2.5x разница)
```

---

## Контакты для отчета
После тестирования сообщите:
- ? Какие тесты прошли успешно
- ? Какие тесты провалились
- ?? Скриншоты (если есть проблемы)
- ?? Предложения по улучшению

Удачного тестирования! ??

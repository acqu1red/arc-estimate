# Фиксированная толщина стен - Техническая документация

## Проблема

Ранее стены представляли собой **динамический объект** с толщиной в мировых координатах:
- Толщина стены вычислялась в миллиметрах (например, 150мм)
- Метод `Wall::GetCornerPoints()` вычислял 4 угловые точки в мировых координатах
- Камера трансформировала эти точки в экранные координаты через `WorldToScreen`
- **При приближении камеры толщина стены масштабировалась и становилась больше/меньше**

## Решение

Теперь стены являются **статичными объектами** с фиксированной толщиной в пикселях:

### Ключевые изменения в `WallRenderer.h`

#### 1. Новая константа толщины стены
```cpp
const float m_wallThicknessPx{ 10.0f };  // Фиксированная толщина в пикселях
```

#### 2. Новый алгоритм отрисовки

**Старый алгоритм (динамический):**
```cpp
// 1. Получить угловые точки в мировых координатах
WorldPoint p1, p2, p3, p4;
wall.GetCornerPoints(p1, p2, p3, p4);

// 2. Трансформировать в экранные координаты
ScreenPoint s1 = camera.WorldToScreen(p1);
// ... толщина масштабируется вместе с камерой!
```

**Новый алгоритм (статический):**
```cpp
// 1. Преобразовать ТОЛЬКО осевые точки стены
WorldPoint startWorld = wall.GetStartPoint();
WorldPoint endWorld = wall.GetEndPoint();
ScreenPoint startScreen = camera.WorldToScreen(startWorld);
ScreenPoint endScreen = camera.WorldToScreen(endWorld);

// 2. Вычислить перпендикулярное направление В ЭКРАННЫХ КООРДИНАТАХ
float dx = endScreen.X - startScreen.X;
float dy = endScreen.Y - startScreen.Y;
float perpX = -dy / length;
float perpY = dx / length;

// 3. Применить ФИКСИРОВАННУЮ толщину в пикселях
float halfThicknessPx = m_wallThicknessPx / 2.0f;

// 4. Построить 4 угловые точки в экранных координатах
ScreenPoint s1(startScreen.X + perpX * halfThicknessPx, ...);
```

## Принцип работы

### До изменений:
```
Мировые координаты (150мм) 
    ? [GetCornerPoints]
4 угловые точки (мировые)
    ? [Camera.WorldToScreen]
4 угловые точки (экранные) ? МАСШТАБИРУЮТСЯ
```

### После изменений:
```
Мировые координаты (осевая линия)
    ? [Camera.WorldToScreen]
2 точки осевой линии (экранные)
    ? [Вычисление в экранных координатах]
4 угловые точки (экранные) ? ФИКСИРОВАННАЯ ТОЛЩИНА
```

## Преимущества

1. ? **Фиксированная визуальная толщина** - стена всегда имеет одинаковую толщину на экране
2. ? **Консистентный UI** - как в профессиональных CAD-системах (AutoCAD, ArchiCAD)
3. ? **Лучшая читаемость** - при любом зуме стены видны одинаково четко
4. ? **Производительность** - меньше трансформаций координат

## Параметры настройки

В классе `WallRenderer`:

```cpp
const float m_wallThicknessPx{ 10.0f };       // Толщина стены в пикселях
const float m_wallStrokeWidthPx{ 5.0f };      // Толщина обводки
const float m_selectedStrokeWidthPx{ 6.0f };  // Толщина обводки выбранной стены
```

## Визуальное поведение

### При приближении камеры (Zoom In):
- ? Осевая линия стены приближается
- ? Стена увеличивается в длину на экране
- ? **Толщина стены остается фиксированной (10px)**
- ? Обводка остается фиксированной (5px)

### При удалении камеры (Zoom Out):
- ? Осевая линия стены удаляется
- ? Стена уменьшается в длину на экране
- ? **Толщина стены остается фиксированной (10px)**
- ? Обводка остается фиксированной (5px)

## Совместимость

Изменения затрагивают только отрисовку. Логика работы стен не изменилась:
- ? HitTest работает с реальной толщиной в мировых координатах
- ? Привязка (snapping) работает корректно
- ? Размеры и расчеты используют реальную толщину
- ? Сохранение/загрузка не изменились

## Дата внедрения

**Дата:** 2024-12-XX  
**Версия:** M-WALL-STATIC-1.0  
**Статус:** ? Реализовано и протестировано

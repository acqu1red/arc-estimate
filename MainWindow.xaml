<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="estimate1.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:estimate1"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:canvas="using:Microsoft.Graphics.Canvas.UI.Xaml"
    mc:Ignorable="d"
    Title="ARC-Estimate">

    <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <Grid.Resources>
            <SolidColorBrush x:Key="RevitRibbonBackgroundBrush" Color="#2B2F36"/>
            <SolidColorBrush x:Key="RevitRibbonPanelBrush" Color="#353A40"/>
            <SolidColorBrush x:Key="RevitPanelBorderBrush" Color="#454B52"/>
            <SolidColorBrush x:Key="RevitSidebarBackgroundBrush" Color="#2C3137"/>
            <SolidColorBrush x:Key="RevitSidebarBorderBrush" Color="#3B4148"/>
            <SolidColorBrush x:Key="RevitTextPrimaryBrush" Color="#E6E9ED"/>
            <SolidColorBrush x:Key="RevitTextSecondaryBrush" Color="#A9B1BA"/>
            <SolidColorBrush x:Key="RevitCanvasBackgroundBrush" Color="#1F2329"/>
            <SolidColorBrush x:Key="RevitIconTileBorderBrush" Color="#4B525A"/>
            <SolidColorBrush x:Key="RevitIconStrokeBrush" Color="#C9D0D7"/>
            <LinearGradientBrush x:Key="RevitIconTileBrush" StartPoint="0,0" EndPoint="1,1">
                <GradientStop Color="#3C4148" Offset="0"/>
                <GradientStop Color="#2E3339" Offset="1"/>
            </LinearGradientBrush>
            <LinearGradientBrush x:Key="RevitIconLightBrush" StartPoint="0,0" EndPoint="1,1">
                <GradientStop Color="#F1F4F7" Offset="0"/>
                <GradientStop Color="#B7C0C8" Offset="1"/>
            </LinearGradientBrush>
            <LinearGradientBrush x:Key="RevitIconMidBrush" StartPoint="0,0" EndPoint="1,1">
                <GradientStop Color="#9EA7B0" Offset="0"/>
                <GradientStop Color="#6F7882" Offset="1"/>
            </LinearGradientBrush>
            <LinearGradientBrush x:Key="RevitIconDarkBrush" StartPoint="0,0" EndPoint="1,1">
                <GradientStop Color="#6A737C" Offset="0"/>
                <GradientStop Color="#4F575F" Offset="1"/>
            </LinearGradientBrush>
            <Style x:Key="RibbonSectionHeaderText" TargetType="TextBlock">
                <Setter Property="FontSize" Value="11"/>
                <Setter Property="Foreground" Value="{StaticResource RevitTextSecondaryBrush}"/>
                <Setter Property="Margin" Value="0,0,0,4"/>
            </Style>
            <Style x:Key="RibbonTabItemStyle" TargetType="TabViewItem">
                <Setter Property="FontSize" Value="12"/>
                <Setter Property="Padding" Value="12,6"/>
                <Setter Property="Margin" Value="2,0"/>
                <Setter Property="Foreground" Value="{StaticResource RevitTextPrimaryBrush}"/>
            </Style>
            <Style x:Key="RibbonLargeButtonStyle" TargetType="Button">
                <Setter Property="Width" Value="68"/>
                <Setter Property="Height" Value="56"/>
                <Setter Property="Padding" Value="6,4"/>
                <Setter Property="CornerRadius" Value="4"/>
                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                <Setter Property="VerticalContentAlignment" Value="Center"/>
                <Setter Property="Background" Value="#2F343A"/>
                <Setter Property="BorderBrush" Value="{StaticResource RevitPanelBorderBrush}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="Foreground" Value="{StaticResource RevitTextPrimaryBrush}"/>
            </Style>
            <Style x:Key="RibbonSmallButtonStyle" TargetType="Button">
                <Setter Property="Padding" Value="10,6"/>
                <Setter Property="CornerRadius" Value="4"/>
                <Setter Property="MinHeight" Value="28"/>
                <Setter Property="Background" Value="#2F343A"/>
                <Setter Property="BorderBrush" Value="{StaticResource RevitPanelBorderBrush}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="Foreground" Value="{StaticResource RevitTextPrimaryBrush}"/>
            </Style>
            <Style x:Key="RibbonIconTileStyle" TargetType="Border">
                <Setter Property="Width" Value="28"/>
                <Setter Property="Height" Value="28"/>
                <Setter Property="CornerRadius" Value="3"/>
                <Setter Property="Background" Value="{StaticResource RevitIconTileBrush}"/>
                <Setter Property="BorderBrush" Value="{StaticResource RevitIconTileBorderBrush}"/>
                <Setter Property="BorderThickness" Value="1"/>
            </Style>
        </Grid.Resources>
        <Grid.RowDefinitions>
            <!-- Меню -->
            <RowDefinition Height="Auto"/>
            <!-- Основное содержимое -->
            <RowDefinition Height="*"/>
            <!-- Статусная строка -->
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Верхняя панель (Ribbon) -->
        <TabView Grid.Row="0"
                 x:Name="RibbonTabView"
                 IsAddTabButtonVisible="False"
                 TabWidthMode="SizeToContent"
                 Background="{StaticResource RevitRibbonBackgroundBrush}"
                 BorderBrush="{StaticResource RevitPanelBorderBrush}"
                 BorderThickness="0,0,0,1"
                 Padding="0"
                 Foreground="{StaticResource RevitTextPrimaryBrush}">
            <TabView.Resources>
                <Style TargetType="TabViewItem" BasedOn="{StaticResource RibbonTabItemStyle}"/>
            </TabView.Resources>
            <TabView.TabStripHeader>
                <Button x:Name="FileButton"
                        Content="Файл"
                        Margin="6,2,6,2"
                        Padding="8,4"
                    VerticalAlignment="Center"
                    Background="#2F343A"
                    Foreground="{StaticResource RevitTextPrimaryBrush}"
                    BorderBrush="{StaticResource RevitPanelBorderBrush}"
                    BorderThickness="1">
                    <Button.Flyout>
                        <Flyout Placement="Bottom">
                            <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CornerRadius="6"
                                    Padding="16"
                                    MinWidth="520">
                                <Grid ColumnDefinitions="260,*" ColumnSpacing="16">
                                    <StackPanel Grid.Column="0" Spacing="8">
                                        <TextBlock Text="Файл" FontSize="14" FontWeight="SemiBold"/>

                                        <StackPanel Spacing="6">
                                            <TextBlock Text="Новый проект" Style="{StaticResource RibbonSectionHeaderText}"/>
                                            <TextBox x:Name="ProjectNameFlyoutTextBox"
                                                     PlaceholderText="Название проекта"
                                                     Text="{x:Bind ViewModel.ProjectName, Mode=TwoWay}"/>
                                            <Button Content="Создать проект" Click="OnNewProjectClick"/>
                                        </StackPanel>

                                        <Border Height="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}" Margin="0,8,0,8"/>

                                        <Button Content="Открыть..." Click="OnOpenProjectClick"/>
                                        <Button Content="Сохранить" Click="OnSaveProjectClick"/>
                                        <Button Content="Сохранить как..." Click="OnSaveProjectAsClick"/>

                                        <Border Height="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}" Margin="0,8,0,8"/>

                                        <Button Content="Импорт DXF..." Click="OnImportDxfClick"/>
                                        <Button Content="Импорт IFC..." Click="OnImportIfcClick"/>

                                        <Border Height="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}" Margin="0,8,0,8"/>

                                        <Button Content="Конвертировать DXF в стены" Click="OnConvertDxfToWallsClick"/>
                                        <Button Content="Конвертировать IFC в стены" Click="OnConvertIfcToWallsClick"/>

                                        <Border Height="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}" Margin="0,8,0,8"/>

                                        <Button Content="Экспорт сметы в Excel..." Click="OnExportEstimateClick"/>
                                        <Button Content="Экспорт сметы в CSV..." Click="OnExportEstimateCsvClick"/>
                                        <Button Content="Показать сводку сметы" Click="OnShowEstimateSummaryClick"/>
                                        <Button Content="Экспорт чертежа в PDF..." Click="OnExportPdfClick"/>

                                        <Border Height="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}" Margin="0,8,0,8"/>

                                        <Button Content="Выход"/>
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" Spacing="8">
                                        <TextBlock Text="Недавние проекты"
                                                   FontSize="12"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                        <Border Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                                                CornerRadius="4"
                                                Padding="12"
                                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                BorderThickness="1">
                                            <TextBlock Text="Недавние проекты отсутствуют"
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                        </Border>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </Flyout>
                    </Button.Flyout>
                </Button>
            </TabView.TabStripHeader>

            <TabViewItem Header="Архитектура">
                <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                    <StackPanel Orientation="Horizontal" Spacing="10" Padding="6,4">
                        <Border Background="{StaticResource RevitRibbonPanelBrush}"
                            BorderBrush="{StaticResource RevitPanelBorderBrush}"
                                BorderThickness="1"
                                CornerRadius="4"
                                Padding="6,4">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Основные" Style="{StaticResource RibbonSectionHeaderText}"/>
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <Button x:Name="SelectToolButton" Click="OnSelectToolClick" Style="{StaticResource RibbonLargeButtonStyle}">
                                        <StackPanel Spacing="3">
                                            <Border Style="{StaticResource RibbonIconTileStyle}">
                                                <Viewbox Margin="4" Stretch="Uniform">
                                                    <Path Data="M2,2 L12,12 L7,12 L10,18 L8,19 L5,12 L2,14 Z"
                                                          Fill="{StaticResource RevitIconLightBrush}"/>
                                                </Viewbox>
                                            </Border>
                                            <TextBlock Text="Выбор" FontSize="10" TextAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                    <Button x:Name="WallToolButton" Click="OnWallToolClick" Style="{StaticResource RibbonLargeButtonStyle}">
                                        <StackPanel Spacing="3">
                                            <Border Style="{StaticResource RibbonIconTileStyle}">
                                                <Viewbox Stretch="Uniform" Margin="3">
                                                    <Canvas Width="24" Height="24">
                                                        <Rectangle Canvas.Left="3" Canvas.Top="9" Width="18" Height="6" Fill="{StaticResource RevitIconMidBrush}"/>
                                                        <Rectangle Canvas.Left="3" Canvas.Top="9" Width="18" Height="2" Fill="{StaticResource RevitIconLightBrush}"/>
                                                        <Rectangle Canvas.Left="17" Canvas.Top="9" Width="4" Height="6" Fill="{StaticResource RevitIconDarkBrush}"/>
                                                    </Canvas>
                                                </Viewbox>
                                            </Border>
                                            <TextBlock Text="Стена" FontSize="10" TextAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <Border Background="{StaticResource RevitRibbonPanelBrush}"
                            BorderBrush="{StaticResource RevitPanelBorderBrush}"
                                BorderThickness="1"
                                CornerRadius="4"
                            Padding="6,4">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Проёмы" Style="{StaticResource RibbonSectionHeaderText}"/>
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <Button x:Name="DoorToolButton" Click="OnDoorToolClick" Style="{StaticResource RibbonLargeButtonStyle}">
                                        <StackPanel Spacing="3">
                                            <Border Style="{StaticResource RibbonIconTileStyle}">
                                                <Viewbox Stretch="Uniform" Margin="3">
                                                    <Canvas Width="24" Height="24">
                                                        <Rectangle Canvas.Left="3" Canvas.Top="10" Width="18" Height="4" Fill="{StaticResource RevitIconMidBrush}"/>
                                                        <Line X1="6" Y1="10" X2="6" Y2="18" Stroke="{StaticResource RevitIconLightBrush}" StrokeThickness="1.2"/>
                                                        <Path Data="M6,10 A8,8 0 0 1 14,18" Stroke="{StaticResource RevitIconLightBrush}" StrokeThickness="1.2"/>
                                                    </Canvas>
                                                </Viewbox>
                                            </Border>
                                            <TextBlock Text="Дверь" FontSize="10" TextAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                    <Button x:Name="WindowToolButton" Click="OnWindowToolClick" Style="{StaticResource RibbonLargeButtonStyle}">
                                        <StackPanel Spacing="3">
                                            <Border Style="{StaticResource RibbonIconTileStyle}">
                                                <Viewbox Stretch="Uniform" Margin="3">
                                                    <Canvas Width="24" Height="24">
                                                        <Rectangle Canvas.Left="4" Canvas.Top="6" Width="16" Height="12" Stroke="{StaticResource RevitIconLightBrush}" StrokeThickness="1.2" Fill="Transparent"/>
                                                        <Line X1="4" Y1="12" X2="20" Y2="12" Stroke="{StaticResource RevitIconLightBrush}" StrokeThickness="1.2"/>
                                                        <Line X1="12" Y1="6" X2="12" Y2="18" Stroke="{StaticResource RevitIconLightBrush}" StrokeThickness="1.2"/>
                                                    </Canvas>
                                                </Viewbox>
                                            </Border>
                                            <TextBlock Text="Окно" FontSize="10" TextAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <Border Background="{StaticResource RevitRibbonPanelBrush}"
                            BorderBrush="{StaticResource RevitPanelBorderBrush}"
                                BorderThickness="1"
                                CornerRadius="4"
                            Padding="6,4">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Редактирование" Style="{StaticResource RibbonSectionHeaderText}"/>
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <Button x:Name="TrimExtendToolButton" Click="OnTrimExtendToolClick" Style="{StaticResource RibbonLargeButtonStyle}">
                                        <StackPanel Spacing="3">
                                            <Border Style="{StaticResource RibbonIconTileStyle}">
                                                <Viewbox Stretch="Uniform" Margin="3">
                                                    <Canvas Width="24" Height="24">
                                                        <Line X1="4" Y1="8" X2="20" Y2="8" Stroke="{StaticResource RevitIconLightBrush}" StrokeThickness="1.4"/>
                                                        <Line X1="8" Y1="16" X2="20" Y2="16" Stroke="{StaticResource RevitIconMidBrush}" StrokeThickness="1.4"/>
                                                        <Line X1="8" Y1="10" X2="8" Y2="22" Stroke="{StaticResource RevitIconLightBrush}" StrokeThickness="1.2"/>
                                                    </Canvas>
                                                </Viewbox>
                                            </Border>
                                            <TextBlock Text="Обрезать" FontSize="10" TextAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                    <Button x:Name="SplitToolButton" Click="OnSplitToolClick" Style="{StaticResource RibbonLargeButtonStyle}">
                                        <StackPanel Spacing="3">
                                            <Border Style="{StaticResource RibbonIconTileStyle}">
                                                <Viewbox Stretch="Uniform" Margin="3">
                                                    <Canvas Width="24" Height="24">
                                                        <Line X1="4" Y1="12" X2="10" Y2="12" Stroke="{StaticResource RevitIconLightBrush}" StrokeThickness="1.4"/>
                                                        <Line X1="14" Y1="12" X2="20" Y2="12" Stroke="{StaticResource RevitIconLightBrush}" StrokeThickness="1.4"/>
                                                        <Line X1="12" Y1="6" X2="12" Y2="18" Stroke="{StaticResource RevitIconMidBrush}" StrokeThickness="1.2"/>
                                                    </Canvas>
                                                </Viewbox>
                                            </Border>
                                            <TextBlock Text="Разделить" FontSize="10" TextAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <Border Background="{StaticResource RevitRibbonPanelBrush}"
                            BorderBrush="{StaticResource RevitPanelBorderBrush}"
                                BorderThickness="1"
                                CornerRadius="4"
                            Padding="6,4">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Конструкции" Style="{StaticResource RibbonSectionHeaderText}"/>
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <Button x:Name="ColumnToolButton" Click="OnColumnToolClick" Style="{StaticResource RibbonLargeButtonStyle}">
                                        <StackPanel Spacing="3">
                                            <Border Style="{StaticResource RibbonIconTileStyle}">
                                                <Viewbox Stretch="Uniform" Margin="3">
                                                    <Canvas Width="24" Height="24">
                                                        <Rectangle Canvas.Left="8" Canvas.Top="5" Width="8" Height="14" Fill="{StaticResource RevitIconMidBrush}"/>
                                                        <Rectangle Canvas.Left="8" Canvas.Top="5" Width="8" Height="3" Fill="{StaticResource RevitIconLightBrush}"/>
                                                        <Rectangle Canvas.Left="15" Canvas.Top="5" Width="2" Height="14" Fill="{StaticResource RevitIconDarkBrush}"/>
                                                    </Canvas>
                                                </Viewbox>
                                            </Border>
                                            <TextBlock Text="Колонна" FontSize="10" TextAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                    <Button x:Name="SlabToolButton" Click="OnSlabToolClick" Style="{StaticResource RibbonLargeButtonStyle}">
                                        <StackPanel Spacing="3">
                                            <Border Style="{StaticResource RibbonIconTileStyle}">
                                                <Viewbox Stretch="Uniform" Margin="3">
                                                    <Canvas Width="24" Height="24">
                                                        <Rectangle Canvas.Left="4" Canvas.Top="9" Width="16" Height="6" Fill="{StaticResource RevitIconMidBrush}"/>
                                                        <Rectangle Canvas.Left="4" Canvas.Top="9" Width="16" Height="2" Fill="{StaticResource RevitIconLightBrush}"/>
                                                        <Rectangle Canvas.Left="18" Canvas.Top="9" Width="2" Height="6" Fill="{StaticResource RevitIconDarkBrush}"/>
                                                    </Canvas>
                                                </Viewbox>
                                            </Border>
                                            <TextBlock Text="Перекрытие" FontSize="10" TextAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                    <Button x:Name="BeamToolButton" Click="OnBeamToolClick" Style="{StaticResource RibbonLargeButtonStyle}">
                                        <StackPanel Spacing="3">
                                            <Border Style="{StaticResource RibbonIconTileStyle}">
                                                <Viewbox Stretch="Uniform" Margin="3">
                                                    <Canvas Width="24" Height="24">
                                                        <Rectangle Canvas.Left="3" Canvas.Top="10" Width="18" Height="5" Fill="{StaticResource RevitIconMidBrush}"/>
                                                        <Rectangle Canvas.Left="3" Canvas.Top="10" Width="18" Height="2" Fill="{StaticResource RevitIconLightBrush}"/>
                                                        <Rectangle Canvas.Left="17" Canvas.Top="10" Width="4" Height="5" Fill="{StaticResource RevitIconDarkBrush}"/>
                                                    </Canvas>
                                                </Viewbox>
                                            </Border>
                                            <TextBlock Text="Балка" FontSize="10" TextAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabViewItem>

            <TabViewItem Header="Правка">
                <StackPanel Orientation="Horizontal" Spacing="10" Padding="6,4">
                        <Border Background="{StaticResource RevitRibbonPanelBrush}"
                            BorderBrush="{StaticResource RevitPanelBorderBrush}"
                            BorderThickness="1"
                            CornerRadius="4"
                            Padding="6,4">
                        <StackPanel Spacing="4">
                            <TextBlock Text="История" Style="{StaticResource RibbonSectionHeaderText}"/>
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Button Click="OnUndoClick" Style="{StaticResource RibbonSmallButtonStyle}">
                                    <StackPanel Orientation="Horizontal" Spacing="6" HorizontalAlignment="Center">
                                        <FontIcon Glyph="&#xE10E;"/>
                                        <TextBlock Text="Отменить"/>
                                    </StackPanel>
                                </Button>
                                <Button Click="OnRedoClick" Style="{StaticResource RibbonSmallButtonStyle}">
                                    <StackPanel Orientation="Horizontal" Spacing="6" HorizontalAlignment="Center">
                                        <FontIcon Glyph="&#xE10D;"/>
                                        <TextBlock Text="Повторить"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                        <Border Background="{StaticResource RevitRibbonPanelBrush}"
                            BorderBrush="{StaticResource RevitPanelBorderBrush}"
                            BorderThickness="1"
                            CornerRadius="4"
                            Padding="6,4">
                        <StackPanel Spacing="4">
                            <TextBlock Text="Типы" Style="{StaticResource RibbonSectionHeaderText}"/>
                            <Button Click="OnWallTypeEditorClick" Style="{StaticResource RibbonSmallButtonStyle}">
                                <StackPanel Orientation="Horizontal" Spacing="6" HorizontalAlignment="Center">
                                    <FontIcon Glyph="&#xE70F;"/>
                                    <TextBlock Text="Редактор типов стен"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </TabViewItem>

            <TabViewItem Header="Вид">
                <StackPanel Orientation="Horizontal" Spacing="10" Padding="6,4">
                        <Border Background="{StaticResource RevitRibbonPanelBrush}"
                            BorderBrush="{StaticResource RevitPanelBorderBrush}"
                            BorderThickness="1"
                            CornerRadius="4"
                            Padding="6,4">
                        <StackPanel Spacing="4">
                            <TextBlock Text="Отображение" Style="{StaticResource RibbonSectionHeaderText}"/>
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <ToggleButton x:Name="GridToggleButton"
                                              IsChecked="{Binding IsChecked, ElementName=GridToggle, Mode=TwoWay}"
                                              Checked="OnGridToggleClick"
                                              Unchecked="OnGridToggleClick"
                                              Background="#2F343A"
                                              BorderBrush="{StaticResource RevitPanelBorderBrush}"
                                              BorderThickness="1"
                                              CornerRadius="4"
                                              Padding="8,6">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <Border Style="{StaticResource RibbonIconTileStyle}">
                                            <Grid>
                                                <Rectangle Width="18" Height="18" Fill="{StaticResource RevitIconLightBrush}" Opacity="0.15"/>
                                                <Rectangle Width="14" Height="2" Fill="{StaticResource RevitIconStrokeBrush}" VerticalAlignment="Top" Margin="0,3,0,0"/>
                                                <Rectangle Width="14" Height="2" Fill="{StaticResource RevitIconStrokeBrush}" VerticalAlignment="Center"/>
                                                <Rectangle Width="14" Height="2" Fill="{StaticResource RevitIconStrokeBrush}" VerticalAlignment="Bottom" Margin="0,0,0,3"/>
                                                <Rectangle Width="2" Height="14" Fill="{StaticResource RevitIconStrokeBrush}" HorizontalAlignment="Left" Margin="3,0,0,0"/>
                                                <Rectangle Width="2" Height="14" Fill="{StaticResource RevitIconStrokeBrush}" HorizontalAlignment="Center"/>
                                                <Rectangle Width="2" Height="14" Fill="{StaticResource RevitIconStrokeBrush}" HorizontalAlignment="Right" Margin="0,0,3,0"/>
                                            </Grid>
                                        </Border>
                                        <TextBlock Text="Показать сетку"
                                                   VerticalAlignment="Center"
                                                   Foreground="{StaticResource RevitTextPrimaryBrush}"/>
                                    </StackPanel>
                                </ToggleButton>
                                <CheckBox x:Name="GridToggle"
                                          Content="Сетка"
                                          IsChecked="False"
                                          Checked="OnGridToggleClick"
                                          Unchecked="OnGridToggleClick"
                                          Visibility="Collapsed"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                        <Border Background="{StaticResource RevitRibbonPanelBrush}"
                            BorderBrush="{StaticResource RevitPanelBorderBrush}"
                            BorderThickness="1"
                            CornerRadius="4"
                            Padding="6,4">
                        <StackPanel Spacing="4">
                            <TextBlock Text="Масштаб" Style="{StaticResource RibbonSectionHeaderText}"/>
                            <ComboBox x:Name="ScaleComboBox"
                                      MinWidth="110"
                                      SelectionChanged="OnScaleChanged">
                                <ComboBoxItem Content="1:20"/>
                                <ComboBoxItem Content="1:50"/>
                                <ComboBoxItem Content="1:100"/>
                                <ComboBoxItem Content="1:200"/>
                                <ComboBoxItem Content="1:500"/>
                            </ComboBox>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </TabViewItem>

            <TabViewItem Header="Справка">
                <StackPanel Orientation="Horizontal" Spacing="10" Padding="6,4">
                        <Border Background="{StaticResource RevitRibbonPanelBrush}"
                            BorderBrush="{StaticResource RevitPanelBorderBrush}"
                            BorderThickness="1"
                            CornerRadius="4"
                            Padding="6,4">
                        <StackPanel Spacing="4">
                            <TextBlock Text="Инструменты" Style="{StaticResource RibbonSectionHeaderText}"/>
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Button Click="OnRunTestsClick" Style="{StaticResource RibbonSmallButtonStyle}">
                                    <StackPanel Orientation="Horizontal" Spacing="6" HorizontalAlignment="Center">
                                        <FontIcon Glyph="&#xE768;"/>
                                        <TextBlock Text="Запустить тесты"/>
                                    </StackPanel>
                                </Button>
                                <Button Content="О программе" Click="OnAboutClick" Style="{StaticResource RibbonSmallButtonStyle}"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </TabViewItem>
        </TabView>

                <!-- Основная область с панелями -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <!-- Левая панель свойств -->
                <ColumnDefinition Width="Auto"/>
                <!-- Центральная область с холстом -->
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Левая панель свойств -->
            <Border Grid.Column="0"
                    Background="{StaticResource RevitSidebarBackgroundBrush}"
                    BorderBrush="{StaticResource RevitSidebarBorderBrush}"
                    BorderThickness="0,0,1,0"
                    Width="200">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="8">
                        <TextBlock Text="Свойства"
                                   FontSize="14"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,10"/>

                        <!-- Разделитель -->
                        <Border Height="1"
                            Background="{StaticResource RevitSidebarBorderBrush}"
                                Margin="0,0,0,10"/>

                        <!-- Панель слоёв -->
                        <TextBlock Text="Слои"
                                   FontSize="11"
                                   Foreground="{StaticResource RevitTextSecondaryBrush}"
                                   Margin="0,0,0,6"/>

                        <StackPanel x:Name="LayersPanel" Spacing="4">
                            <!-- Слой: Существующее -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Border Grid.Column="0"
                                        Width="14" Height="14"
                                        Background="#FF282828"
                                        CornerRadius="2"
                                        Margin="0,0,6,0"/>
                                <TextBlock Grid.Column="1"
                                           Text="Существующее"
                                           VerticalAlignment="Center"
                                           FontSize="11"/>
                                <CheckBox Grid.Column="2"
                                          x:Name="ExistingLayerCheckBox"
                                          IsChecked="True"
                                          Checked="OnLayerVisibilityChanged"
                                          Unchecked="OnLayerVisibilityChanged"
                                          MinWidth="0" Padding="0"/>
                            </Grid>

                            <!-- Слой: Демонтаж -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Border Grid.Column="0"
                                        Width="14" Height="14"
                                        Background="#FFC83232"
                                        CornerRadius="2"
                                        Margin="0,0,6,0"/>
                                <TextBlock Grid.Column="1"
                                           Text="Демонтаж"
                                           VerticalAlignment="Center"
                                           FontSize="11"/>
                                <CheckBox Grid.Column="2"
                                          x:Name="DemolishLayerCheckBox"
                                          IsChecked="False"
                                          Checked="OnLayerVisibilityChanged"
                                          Unchecked="OnLayerVisibilityChanged"
                                          MinWidth="0" Padding="0"/>
                            </Grid>

                            <!-- Слой: Новое -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Border Grid.Column="0"
                                        Width="14" Height="14"
                                        Background="#FF3264C8"
                                        CornerRadius="2"
                                        Margin="0,0,6,0"/>
                                <TextBlock Grid.Column="1"
                                           Text="Новое"
                                           VerticalAlignment="Center"
                                           FontSize="11"/>
                                <CheckBox Grid.Column="2"
                                          x:Name="NewLayerCheckBox"
                                          IsChecked="False"
                                          Checked="OnLayerVisibilityChanged"
                                          Unchecked="OnLayerVisibilityChanged"
                                          MinWidth="0" Padding="0"/>
                            </Grid>
                        </StackPanel>

                        <!-- Разделитель -->
                        <Border Height="1"
                            Background="{StaticResource RevitSidebarBorderBrush}"
                                Margin="0,12,0,12"/>

                        <!-- Свойства выбранного элемента -->
                        <TextBlock Text="Выбранный элемент"
                                   FontSize="11"
                                   Foreground="{StaticResource RevitTextSecondaryBrush}"
                                   Margin="0,0,0,6"/>

                        <TextBlock x:Name="SelectedElementInfo"
                                   Text="Ничего не выбрано"
                                   Foreground="#8D949C"
                                   FontStyle="Italic"
                                   Margin="0,0,0,12"/>

                        <!-- Свойства стены (будет показано при выборе стены) -->
                        <StackPanel x:Name="WallPropertiesPanel" Visibility="Collapsed">
                            <TextBlock Text="Тип стены"
                                       FontSize="11"
                                       Margin="0,0,0,4"/>
                            <ComboBox x:Name="WallTypeComboBox"
                                      SelectedIndex="-1"
                                      HorizontalAlignment="Stretch"
                                      SelectionChanged="OnWallTypeChanged"
                                      Margin="0,0,0,10"/>

                            <TextBlock Text="Слои"
                                       FontSize="11"
                                       Margin="0,0,0,4"/>
                            <TextBlock x:Name="WallLayersText"
                                       Text=""
                                       TextWrapping="Wrap"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       Margin="0,0,0,10"/>

                            <TextBlock Text="Толщина (мм)"
                                       FontSize="11"
                                       Margin="0,0,0,4"/>
                            <NumberBox x:Name="WallThicknessBox"
                                       Value="150"
                                       Minimum="50"
                                       Maximum="1000"
                                       SpinButtonPlacementMode="Compact"
                                       ValueChanged="OnWallThicknessChanged"
                                       Margin="0,0,0,10"/>

                            <TextBlock Text="Рабочее состояние"
                                       FontSize="11"
                                       Margin="0,0,0,4"/>
                            <ComboBox x:Name="WorkStateComboBox"
                                      SelectedIndex="0"
                                      HorizontalAlignment="Stretch"
                                      SelectionChanged="OnWallWorkStateChanged"
                                      Margin="0,0,0,10">
                                <ComboBoxItem Content="Существующее"/>
                                <ComboBoxItem Content="Снести"/>
                                <ComboBoxItem Content="Новое"/>
                            </ComboBox>

                            <TextBlock Text="Линия размещения"
                                       FontSize="11"
                                       Margin="0,0,0,4"/>
                            <ComboBox x:Name="LocationLineComboBox"
                                      SelectedIndex="0"
                                      HorizontalAlignment="Stretch"
                                      SelectionChanged="OnWallLocationLineChanged">
                                <ComboBoxItem Content="Ось стены"/>
                                <ComboBoxItem Content="Ось несущего слоя"/>
                                <ComboBoxItem Content="Наружная чистовая"/>
                                <ComboBoxItem Content="Внутренняя чистовая"/>
                                <ComboBoxItem Content="Наружная несущая"/>
                                <ComboBoxItem Content="Внутренняя несущая"/>
                            </ComboBox>
                        </StackPanel>

                    </StackPanel>
                </ScrollViewer>
            </Border>

            <!-- Центральная область с вкладками и холстом -->
            <Grid Grid.Column="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <!-- R-WALL: Панель привязки стен -->
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Вкладки планов -->
                <Border Grid.Row="0" 
                        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="0,0,0,1">
                    <StackPanel Orientation="Horizontal" Margin="4">
                        <RadioButton x:Name="MeasureViewTab"
                                     Content="Обмерный"
                                     GroupName="PlanViews"
                                     IsChecked="True"
                                     Style="{StaticResource DefaultRadioButtonStyle}"
                                     Checked="OnViewTabChanged"/>
                        <RadioButton x:Name="DemolitionViewTab"
                                     Content="Демонтаж"
                                     GroupName="PlanViews"
                                     Style="{StaticResource DefaultRadioButtonStyle}"
                                     Checked="OnViewTabChanged"/>
                        <RadioButton x:Name="ConstructionViewTab"
                                     Content="Новый"
                                     GroupName="PlanViews"
                                                              Style="{StaticResource DefaultRadioButtonStyle}"
                                                              Checked="OnViewTabChanged"/>
                                             </StackPanel>
                                         </Border>

                <!-- R-WALL: Панель привязки стен (показывается только при выборе инструмента Wall) -->
                <Border x:Name="WallAttachmentModePanel"
                        Grid.Row="1"
                        Visibility="Collapsed"
                        Background="#F5F5F5"
                        BorderBrush="#CCCCCC"
                        BorderThickness="0,1,0,1"
                        Padding="12,8"
                        Height="48">
                    <StackPanel Orientation="Horizontal" Spacing="16">
                        <TextBlock Text="Привязка:"
                                   VerticalAlignment="Center"
                                   FontWeight="SemiBold"
                                   FontSize="13"/>

                        <!-- Осевая линия (Центр) -->
                        <RadioButton x:Name="AttachmentModeCore"
                                     GroupName="WallAttachment"
                                     IsChecked="True"
                                     Click="OnWallAttachmentModeChanged"
                                     VerticalAlignment="Center">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Rectangle Width="24" Height="3" Fill="#0078D4"/>
                                <TextBlock Text="Осевая линия" VerticalAlignment="Center"/>
                            </StackPanel>
                        </RadioButton>

                        <!-- Чистовая наружная -->
                        <RadioButton x:Name="AttachmentModeExterior"
                                     GroupName="WallAttachment"
                                     Click="OnWallAttachmentModeChanged"
                                     VerticalAlignment="Center">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Rectangle Width="24" Height="3" Fill="#00B400"/>
                                <TextBlock Text="Чистовая наружная" VerticalAlignment="Center"/>
                            </StackPanel>
                        </RadioButton>

                        <!-- Чистовая внутренняя -->
                        <RadioButton x:Name="AttachmentModeInterior"
                                     GroupName="WallAttachment"
                                     Click="OnWallAttachmentModeChanged"
                                     VerticalAlignment="Center">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Rectangle Width="24" Height="3" Fill="#C80000"/>
                                <TextBlock Text="Чистовая внутренняя" VerticalAlignment="Center"/>
                            </StackPanel>
                        </RadioButton>
                    </StackPanel>
                </Border>

                                         <!-- Холст для рисования Win2D -->
                                         <Border Grid.Row="2" 
                                             Background="{StaticResource RevitCanvasBackgroundBrush}"
                                                 Margin="0"
                                                 IsTabStop="True"
                                                 KeyDown="OnCanvasKeyDown">
                                             <canvas:CanvasControl x:Name="DrawingCanvas"
                                                                   Draw="OnCanvasDraw"
                                                                   CreateResources="OnCanvasCreateResources"
                                                                   PointerPressed="OnCanvasPointerPressed"
                                                                   PointerMoved="OnCanvasPointerMoved"
                                                                   PointerReleased="OnCanvasPointerReleased"
                                                                   PointerWheelChanged="OnCanvasPointerWheelChanged"
                                                                   SizeChanged="OnCanvasSizeChanged"/>
                                         </Border>
                                     </Grid>

        </Grid>

        <!-- Статусная строка -->
        <Border Grid.Row="2"
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="0,1,0,0"
                Padding="12,6">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock x:Name="StatusTextBlock"
                           Grid.Column="0"
                           Text="{x:Bind ViewModel.StatusText, Mode=OneWay}"
                           VerticalAlignment="Center"
                           FontSize="12"/>

                <StackPanel Grid.Column="1" 
                            Orientation="Horizontal"
                            Spacing="16">
                    
                    <!-- M5.6: Snap Mode Selector -->
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock Text="Привязка:"
                                   VerticalAlignment="Center"
                                   FontSize="12"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        <ComboBox x:Name="SnapModeComboBox"
                                  SelectedIndex="0"
                                  MinWidth="120"
                                  FontSize="12">
                            <ComboBoxItem Content="Авто"/>
                            <ComboBoxItem Content="Ось стены"/>
                            <ComboBoxItem Content="Наружная"/>
                            <ComboBoxItem Content="Внутренняя"/>
                            <ComboBoxItem Content="Ядро (нар.)"/>
                            <ComboBoxItem Content="Ядро (вн.)"/>
                        </ComboBox>
                        <TextBlock x:Name="SnapIndicatorText"
                                   Text=""
                                   VerticalAlignment="Center"
                                   FontSize="12"
                                   Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                   Margin="8,0,0,0"/>
                    </StackPanel>

                    <TextBlock x:Name="ScaleStatusText"
                               Text="Масштаб: 1:50"
                               VerticalAlignment="Center"
                               FontSize="12"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
